<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
	<link rel="manifest" href="../manifest.json" />
	<link rel="stylesheet" href="vr.css" />
	<script src="https://arrange.avorium.de/arrange-client.min.js"></script>
	<script src="../shared/three.js"></script>
	<script src="../shared/firstpersoncontrols.js"></script>
	<script src="../shared/vrcontrols.js"></script>
	<script src="../shared/voxelmodel.js"></script>
	<script src="../shared/utils.js"></script>
	<script src="scene.js"></script>
	<script type="x-shader/x-vertex" id="vertexshader">
attribute vec3 customColor;
varying vec3 vColor;
void main() 
{
	vColor = customColor; // set color associated to vertex; use later in fragment shader
	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );

	// option (1): draw particles at constant size on screen
	//gl_PointSize = 1.0;
	// option (2): scale particles as objects in 3D space
	gl_PointSize = 1.0 * ( 10.0 / length( mvPosition.xyz ) );
	gl_Position = projectionMatrix * mvPosition;
}
		</script>

	<script type="x-shader/x-fragment" id="fragmentshader">
uniform sampler2D texture;
varying vec3 vColor; // colors associated to vertices; assigned by vertex shader
void main() 
{
	// calculates a color for the particle
	gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0);
	//gl_FragColor = vec4( vColor, 1.0 );
	// sets particle texture to desired color
	//gl_FragColor = gl_FragColor * texture2D( texture, gl_PointCoord );
}
		</script>
	<script>

		var scene;

		_l(async function () {

			scene = new Scene();
			scene.attachTo(document.body);

			scene.addDebugRoom();

			if (await VRControls.isAvailable()) {
				scene.addVRControls();
			} else {
				scene.addFirstPersonControls();
			}

			scene.addDemoParticles();

			const arrangeClient = await ArrangeClient().connect('wss://arrange.avorium.de:42001');
			const modelsFromServer = await arrangeClient.search('voxelhoxel', 'models', {}, '_id');
			console.log(modelsFromServer);

			for (let i = 0; i < modelsFromServer.length; i++) {
				const modelData = await arrangeClient.read('voxelhoxel', 'models', modelsFromServer[i]._id);
				const voxelModel = new VoxelModel(modelData);
				const object3D = voxelModel.object3D;
				object3D.scale.multiplyScalar(.01);
				object3D.position.set(i * .5, 0, -1);
				//scene.scene.add(object3D);
				console.log(voxelModel.arrangeModel._id);
			}

		});

	</script>
</head>

<body></body>

</html>